pipeline {
    agent any

    environment {
        DOCKER_IMAGE = 'srinidhi-maven-project:v1'
        EC2_INSTANCE = 'ubuntu@ec2-54-209-40-123.compute-1.amazonaws.com'
        SSH_CREDENTIALS_ID = 'c47be239-4c01-41c3-b443-c842d1c3c916'
    }

    stages {
        stage('Deploy to EC2') {
            steps {
                script {
                    // SSH into EC2 instance
                    sshagent(credentials:[SSH_CREDENTIALS_ID]) {
                        // Pull Docker image from Docker Hub
                        sh "ssh -o StrictHostKeyChecking=no ${EC2_INSTANCE} 'docker pull ${DOCKER_IMAGE}'"

                        // Run Docker container on EC2 instance
                        sh "ssh -o StrictHostKeyChecking=no ${EC2_INSTANCE} 'docker run -d -p 8080:8080 ${DOCKER_IMAGE}'"
                    }
                }
            }
        }
    }
}
