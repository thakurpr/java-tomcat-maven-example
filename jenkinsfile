pipeline {
    agent any

    environment {
        DOCKER_IMAGE = 'srinidhi-maven-project:v1'
        EC2_INSTANCE = 'ubuntu@ec2-54-209-40-123.compute-1.amazonaws.com'
        SSH_PRIVATE_KEY = credentials('c47be239-4c01-41c3-b443-c842d1c3c916')
    }

    stages {
        stage('Debug SSH Key') {
            steps {
                script {
                    // Print SSH private key for debugging
                    echo "SSH Private Key: ${SSH_PRIVATE_KEY}"

                    // Print EC2 instance details for debugging
                    echo "EC2 Instance: ${EC2_INSTANCE}"
                }
            }
        }

    stages {
         stage('Deploy to EC2') {
            steps {
                script {
                    // SSH into EC2 instance
                    sshagent(credentials[SSH_PRIVATE_KEY]) {
                        // Pull Docker image from Docker Hub
                        sh "ssh -o StrictHostKeyChecking=no ${EC2_INSTANCE} 'docker pull ${DOCKER_IMAGE}'"

                        // Run Docker container on EC2 instance
                        sh "ssh -o StrictHostKeyChecking=no ${EC2_INSTANCE} 'docker run -d -p 8080:8080 ${DOCKER_IMAGE}'"
                    }
                }
            }
        }
    }
}
